---
import { sanitizeUrl } from '../utils/sanitize';

interface Props {
  title: string;
  time?: string;
  venue: string;
  url?: string;
  eventType?: string;
  genre?: string;
  description?: string;
  status?: string;
}

const { title, time, venue, url, eventType, genre, description, status } = Astro.props;

const safeUrl = sanitizeUrl(url);
const infoTag = genre || (eventType && eventType !== 'concert' ? eventType : null);
const isSoldOut = status === 'sold_out';
---

<a
  href={safeUrl}
  target="_blank"
  rel="noopener noreferrer"
  class="timeline-event group block relative"
>
  <!-- Hover dot (appears on hover) -->
  <span class="timeline-hover-dot" aria-hidden="true"></span>

  <!-- Content -->
  <div class="timeline-content">
    <div class="flex items-center gap-2">
      <h3 class="font-body text-base font-semibold text-text-primary truncate group-hover:text-accent transition-colors">
        {title}
      </h3>
      {isSoldOut && (
        <span class="font-display text-[10px] uppercase text-accent px-1.5 py-0.5 bg-accent-dim rounded flex-shrink-0">
          Sold Out
        </span>
      )}
    </div>
    <div class="mt-0.5 font-display text-xs text-text-muted">
      {infoTag && (
        <>
          <span class="text-text-secondary">{infoTag}</span>
          <span class="text-text-muted"> Â· </span>
        </>
      )}
      {time && <span class="text-text-secondary tabular-nums">{time}</span>}
      {time && <span> @ </span>}
      {!time && <span>@ </span>}
      <span>{venue}</span>
    </div>
    {description && (
      <p class="mt-1 font-body text-xs text-text-muted line-clamp-1">
        {description}
      </p>
    )}
  </div>
</a>

<style>
  .timeline-event {
    display: grid;
    grid-template-columns: 16px 1fr;
    gap: 0.75rem;
    padding: 0.5rem 0;
    min-height: 3rem;
  }

  /* Hover dot - hidden by default, appears on hover */
  .timeline-hover-dot {
    position: relative;
    width: 4px;
    height: 4px;
    background: var(--accent);
    margin-top: 0.5rem;
    margin-left: 6px; /* center at 8px */
    opacity: 0;
    transform: scale(0);
    transition: all 0.15s ease-out;
    z-index: 1;
  }

  /* Content area */
  .timeline-content {
    min-width: 0;
    padding: 0.25rem 0.5rem;
    margin: -0.25rem -0.5rem;
    border-radius: 4px;
    transition: background-color 0.2s ease-out;
  }

  /* Hover state - minimal highlight */
  .timeline-event:hover .timeline-hover-dot {
    opacity: 1;
    transform: scale(1);
  }

  .timeline-event:hover .timeline-content {
    background: var(--bg-secondary);
  }
</style>
