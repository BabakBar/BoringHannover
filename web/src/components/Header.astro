---
interface Props {
  week: number;
  year: number;
}

const { week, year } = Astro.props;
---

<header class="mb-8 section-fade">
  <!-- Top-right controls -->
  <div class="flex justify-end mb-2 gap-1">
    <button
      id="about-open"
      type="button"
      class="p-3 min-w-[44px] min-h-[44px] rounded-lg text-text-secondary hover:text-text-primary hover:bg-bg-secondary transition-colors focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-accent"
      aria-label="About boring hannover"
      aria-haspopup="dialog"
      aria-controls="about-dialog"
    >
      <svg class="w-4 h-4" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2" aria-hidden="true">
        <circle cx="12" cy="12" r="10"></circle>
        <path d="M12 16v-5"></path>
        <path d="M12 8h.01"></path>
      </svg>
    </button>
    <button
      id="theme-toggle"
      type="button"
      class="theme-toggle p-3 min-w-[44px] min-h-[44px] rounded-lg text-text-secondary hover:text-text-primary hover:bg-bg-secondary transition-colors focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-accent"
      aria-label="Toggle theme"
      aria-pressed="false"
    >
      <!-- Sun icon (shown in dark mode) -->
      <svg class="sun-icon w-4 h-4 hidden" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
        <circle cx="12" cy="12" r="5"></circle>
        <path d="M12 1v2M12 21v2M4.22 4.22l1.42 1.42M18.36 18.36l1.42 1.42M1 12h2M21 12h2M4.22 19.78l1.42-1.42M18.36 5.64l1.42-1.42"></path>
      </svg>
      <!-- Moon icon (shown in light mode) -->
      <svg class="moon-icon w-4 h-4" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
        <path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"></path>
      </svg>
    </button>
  </div>

  <!-- Logo with dot-matrix style -->
  <div class="flex items-center justify-center gap-2 mb-2">
    <span class="dots text-accent text-lg" aria-hidden="true">
      <span class="dot">&#9642;</span>
      <span class="dot">&#9642;</span>
      <span class="dot">&#9642;</span>
    </span>
    <h1 class="font-display text-xl font-bold tracking-dot uppercase text-text-primary">
      boring hannover
    </h1>
    <span class="dots text-accent text-lg" aria-hidden="true">
      <span class="dot">&#9642;</span>
      <span class="dot">&#9642;</span>
      <span class="dot">&#9642;</span>
    </span>
  </div>

  <!-- Microcopy (minimal explanation) -->
  <div class="mx-auto max-w-[28rem] font-display text-[11px] text-text-muted tracking-wide leading-tight">
    Weekly digest of OV movies, concerts &amp; events in Hannover.
  </div>

  <!-- Week info -->
  <div class="mt-2 font-display text-xs text-text-secondary tracking-wide">
    W{week} &middot; {year}
  </div>

  <!-- About dialog (optional detail without clutter) -->
  <dialog
    id="about-dialog"
    class="about-dialog w-[min(32rem,calc(100vw-2rem))] bg-bg-primary text-text-primary border border-text-data rounded-lg p-4 text-left"
    aria-labelledby="about-title"
  >
    <form method="dialog">
      <div class="flex items-start justify-between gap-4">
        <div>
          <h2 id="about-title" class="font-display text-sm font-bold tracking-wide uppercase">
            Proving Hannover isnâ€™t THAT boring
          </h2>
          <p class="mt-1 text-sm text-text-secondary leading-relaxed">
            A clean weekly page that aggregates OV cinema listings and a curated radar of concerts &amp; events.
          </p>
        </div>
        <button
          type="submit"
          class="p-3 -m-2 min-w-[44px] min-h-[44px] rounded-lg text-text-secondary hover:text-text-primary hover:bg-bg-secondary transition-colors focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-accent"
          aria-label="Close"
        >
          <svg class="w-4 h-4" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2" aria-hidden="true">
            <path d="M18 6L6 18"></path>
            <path d="M6 6l12 12"></path>
          </svg>
        </button>
      </div>

      <div class="mt-3 text-xs text-text-muted leading-relaxed">
        Sources grow over time; if a venue is missing, open an issue on GitHub.
      </div>

      <div class="mt-4 flex items-center justify-between gap-3">
        <a
          href="https://github.com/BabakBar/BoringHannover"
          class="text-xs font-display text-accent hover:underline"
        >
          GitHub
        </a>
        <button
          type="submit"
          class="text-xs font-display text-text-secondary hover:text-text-primary"
        >
          Close
        </button>
      </div>
    </form>
  </dialog>
</header>

<script>
  const toggle = document.getElementById('theme-toggle');
  const sunIcon = toggle?.querySelector('.sun-icon');
  const moonIcon = toggle?.querySelector('.moon-icon');

  const aboutOpen = document.getElementById('about-open');
  const aboutDialog = document.getElementById('about-dialog');

  function openAbout() {
    if (!(aboutDialog instanceof HTMLDialogElement)) return;
    if (typeof aboutDialog.showModal !== 'function') return;
    aboutDialog.showModal();
  }

  aboutOpen?.addEventListener('click', openAbout);

  // Click outside dialog content closes it.
  aboutDialog?.addEventListener('click', (event) => {
    if (!(aboutDialog instanceof HTMLDialogElement)) return;
    if (event.target === aboutDialog) aboutDialog.close();
  });

  function updateIcons() {
    const isDark = document.documentElement.classList.contains('dark');
    if (sunIcon && moonIcon) {
      sunIcon.classList.toggle('hidden', !isDark);
      moonIcon.classList.toggle('hidden', isDark);
    }
  }

  // Initial icon state
  updateIcons();

  // Update aria-pressed state
  function updateAriaPressed() {
    const isDark = document.documentElement.classList.contains('dark');
    toggle?.setAttribute('aria-pressed', isDark ? 'true' : 'false');
  }

  // Initial aria-pressed state
  updateAriaPressed();

  toggle?.addEventListener('click', () => {
    const isDark = document.documentElement.classList.toggle('dark');
    localStorage.setItem('theme', isDark ? 'dark' : 'light');

    // Update theme-color meta
    const themeColor = document.getElementById('theme-color');
    themeColor?.setAttribute('content', isDark ? '#0a0a0a' : '#fafaf9');

    updateIcons();
    updateAriaPressed();
  });
</script>

<style>
  header {
    text-align: center;
  }

  .dots {
    display: inline-flex;
    gap: 2px;
  }

  .dot {
    display: inline-block;
    animation: pulse 2s ease-in-out infinite;
  }

  .dot:nth-child(1) { animation-delay: 0ms; }
  .dot:nth-child(2) { animation-delay: 200ms; }
  .dot:nth-child(3) { animation-delay: 400ms; }

  @keyframes pulse {
    0%, 100% { opacity: 1; }
    50% { opacity: 0.4; }
  }

  @media (prefers-reduced-motion: reduce) {
    .dot {
      animation: none;
    }
  }

  .about-dialog::backdrop {
    background: rgba(0, 0, 0, 0.55);
  }
</style>
